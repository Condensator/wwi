CREATE TABLE [Sales].[CustomerTransactions](	  [CustomerTransactionID] INT NOT NULL DEFAULT(NEXT VALUE FOR [Sequences].[TransactionID])	, [CustomerID] INT NOT NULL	, [TransactionTypeID] INT NOT NULL	, [InvoiceID] INT NULL	, [PaymentMethodID] INT NULL	, [TransactionDate] DATE NOT NULL	, [AmountExcludingTax] DECIMAL(18,2) NOT NULL	, [TaxAmount] DECIMAL(18,2) NOT NULL	, [TransactionAmount] DECIMAL(18,2) NOT NULL	, [OutstandingBalance] DECIMAL(18,2) NOT NULL	, [FinalizationDate] DATE NULL	, [IsFinalized] AS (case when [FinalizationDate] IS NULL then CONVERT([bit],(0)) else CONVERT([bit],(1)) end)	, [LastEditedBy] INT NOT NULL	, [LastEditedWhen] DATETIME2(7) NOT NULL DEFAULT(sysdatetime())	, CONSTRAINT [PK_Sales_CustomerTransactions] PRIMARY KEY ([CustomerTransactionID] ASC))GOALTER TABLE [Sales].[CustomerTransactions] WITH CHECK ADD CONSTRAINT [FK_Sales_CustomerTransactions_TransactionTypeID_Application_TransactionTypes] FOREIGN KEY([TransactionTypeID]) REFERENCES [Application].[TransactionTypes] ([TransactionTypeID])GOALTER TABLE [Sales].[CustomerTransactions] CHECK CONSTRAINT [FK_Sales_CustomerTransactions_TransactionTypeID_Application_TransactionTypes]GOALTER TABLE [Sales].[CustomerTransactions] WITH CHECK ADD CONSTRAINT [FK_Sales_CustomerTransactions_PaymentMethodID_Application_PaymentMethods] FOREIGN KEY([PaymentMethodID]) REFERENCES [Application].[PaymentMethods] ([PaymentMethodID])GOALTER TABLE [Sales].[CustomerTransactions] CHECK CONSTRAINT [FK_Sales_CustomerTransactions_PaymentMethodID_Application_PaymentMethods]GOALTER TABLE [Sales].[CustomerTransactions] WITH CHECK ADD CONSTRAINT [FK_Sales_CustomerTransactions_InvoiceID_Sales_Invoices] FOREIGN KEY([InvoiceID]) REFERENCES [Sales].[Invoices] ([InvoiceID])GOALTER TABLE [Sales].[CustomerTransactions] CHECK CONSTRAINT [FK_Sales_CustomerTransactions_InvoiceID_Sales_Invoices]GOALTER TABLE [Sales].[CustomerTransactions] WITH CHECK ADD CONSTRAINT [FK_Sales_CustomerTransactions_CustomerID_Sales_Customers] FOREIGN KEY([CustomerID]) REFERENCES [Sales].[Customers] ([CustomerID])GOALTER TABLE [Sales].[CustomerTransactions] CHECK CONSTRAINT [FK_Sales_CustomerTransactions_CustomerID_Sales_Customers]GOALTER TABLE [Sales].[CustomerTransactions] WITH CHECK ADD CONSTRAINT [FK_Sales_CustomerTransactions_Application_People] FOREIGN KEY([LastEditedBy]) REFERENCES [Application].[People] ([PersonID])GOALTER TABLE [Sales].[CustomerTransactions] CHECK CONSTRAINT [FK_Sales_CustomerTransactions_Application_People]GOCREATE NONCLUSTERED INDEX [FK_Sales_CustomerTransactions_CustomerID] ON [Sales].[CustomerTransactions] ([CustomerID] ASC, [TransactionDate] ASC)GOCREATE NONCLUSTERED INDEX [FK_Sales_CustomerTransactions_InvoiceID] ON [Sales].[CustomerTransactions] ([InvoiceID] ASC, [TransactionDate] ASC)GOCREATE NONCLUSTERED INDEX [FK_Sales_CustomerTransactions_PaymentMethodID] ON [Sales].[CustomerTransactions] ([PaymentMethodID] ASC, [TransactionDate] ASC)GOCREATE NONCLUSTERED INDEX [FK_Sales_CustomerTransactions_TransactionTypeID] ON [Sales].[CustomerTransactions] ([TransactionTypeID] ASC, [TransactionDate] ASC)GOCREATE NONCLUSTERED INDEX [IX_Sales_CustomerTransactions_IsFinalized] ON [Sales].[CustomerTransactions] ([IsFinalized] ASC, [TransactionDate] ASC)GO